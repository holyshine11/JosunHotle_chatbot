# TTS (Text-to-Speech) 기능 계획서

> 챗봇 답변을 한국어에 최적화하여 음성으로 읽어주는 기능

---

## 1. 목표

- 봇 응답 메시지에 음성 재생 버튼 추가
- 한국어 자연스러운 발화 (호텔 용어, 시간/가격 등 정확한 읽기)
- 프로젝트 제약 준수: 로컬 실행, 16GB 노트북, 무료/오픈소스

---

## 2. TTS 엔진 비교

| 항목 | Web Speech API | Edge TTS (edge-tts) | gTTS |
|------|---------------|---------------------|------|
| 한국어 품질 | 중 (OS 의존) | **상** (Azure Neural) | 중 |
| 설치 필요 | 없음 (브라우저 내장) | pip install edge-tts | pip install gtts |
| 네트워크 | 불필요 | 필요 (MS Edge 서버) | 필요 (Google 서버) |
| 속도 조절 | O | O | X |
| 음성 선택 | OS 의존 | 다양 (ko-KR-SunHiNeural 등) | 1종 |
| 비용 | 무료 | 무료 | 무료 |
| 서버 부하 | 없음 | API 호출 | API 호출 |
| 오프라인 | O | X | X |

### 추천: Web Speech API (프론트엔드 전용)

**선정 이유:**
1. **서버 부하 제로**: 16GB 노트북 제약에 최적 (백엔드 변경 불필요)
2. **즉시 구현 가능**: 브라우저 내장 API, 추가 패키지 없음
3. **오프라인 동작**: 네트워크 의존성 없음
4. **macOS/Chrome 한국어 음성**: 품질 충분 (Yuna, Sora 등 Neural 음성 제공)

**한계 및 대안:**
- 브라우저/OS별 음성 품질 차이 → 음성 목록에서 최적 선택 로직 구현
- Safari 일부 제약 → `speechSynthesis.cancel()` 워크어라운드 적용
- 향후 품질 업그레이드 필요 시 Edge TTS로 전환 가능 (백엔드 엔드포인트 추가)

---

## 3. 구현 범위

### 3.1 UI 변경 (ui/index.html)

봇 메시지 버블에 TTS 컨트롤 추가:

```
┌─────────────────────────────────────┐
│ 체크인 시간은 오후 3시(15:00)입니다.  │
│                                     │
│ 🔊 ■  ─────────── 0:05/0:12        │
│  재생  정지  진행바       시간        │
└─────────────────────────────────────┘
```

**버튼 구성:**
- 재생/일시정지 토글 (▶ / ⏸)
- 정지 (■)
- 음성 상태 표시 (읽는 중 텍스트 하이라이팅은 V2에서)

**디자인 원칙:**
- 기존 UI 톤 유지 (Tailwind, accent 골드)
- 다크모드 호환
- 모바일 반응형 (터치 영역 44px 이상)
- 재생 중이 아닐 때는 아이콘만 표시 (미니멀)

### 3.2 텍스트 전처리 (핵심)

답변 텍스트를 TTS에 적합하게 변환:

| 원본 | 변환 | 이유 |
|------|------|------|
| `**체크인**` | `체크인` | 마크다운 제거 |
| `[출처](https://...)` | (제거) | URL 읽기 방지 |
| `[REF:1]` | (제거) | 참조 마커 |
| `- 항목1\n- 항목2` | `항목1. 항목2.` | 리스트를 문장으로 |
| `15:00` | `15시` | 시간 읽기 |
| `02-1234-5678` | `공이 일이삼사 오육칠팔` | 전화번호 읽기 |
| `\n\n` | `. ` | 문단 구분을 pause로 |

### 3.3 JavaScript 모듈 구조

```
ui/js/tts/
├── ttsEngine.js      # Web Speech API 래퍼 (재생/일시정지/정지)
└── textPreprocessor.js  # 마크다운/URL/참조 제거, 한국어 최적화
```

### 3.4 기존 코드 수정 포인트

| 파일 | 변경 내용 |
|------|----------|
| `ui/index.html` | renderMessage()에 TTS 버튼 추가, tts 모듈 import |
| `ui/css/style.css` | TTS 버튼 스타일, 재생 중 애니메이션 |
| `rag/server.py` | 변경 없음 (프론트엔드 전용) |

---

## 4. 구현 단계

### Step 1: TTS 엔진 모듈 (`ttsEngine.js`)
- `SpeechSynthesis` API 래퍼 클래스
- 한국어 음성 자동 선택 (ko-KR 우선, Neural 음성 우선)
- play(text), pause(), resume(), stop() 메서드
- 이벤트 콜백: onStart, onEnd, onPause, onError

### Step 2: 텍스트 전처리 (`textPreprocessor.js`)
- 마크다운 제거 (bold, italic, code, link, header)
- URL/참조 마커 제거 (`[REF:N]`, `https://...`)
- 한국어 숫자/시간/전화번호 변환
- 리스트 → 문장 변환
- 빈 줄/중복 공백 정리

### Step 3: UI 통합 (`index.html`)
- 봇 메시지에 스피커 아이콘 추가
- 클릭 시 전처리 → TTS 재생
- 재생 상태 UI 반영 (아이콘 변경)
- 다른 메시지 재생 시 이전 재생 자동 중지

### Step 4: 스타일링 (`style.css`)
- TTS 버튼 스타일 (라이트/다크 모드)
- 재생 중 애니메이션 (pulse)
- 반응형 레이아웃

### Step 5: 테스트
- 다양한 답변 형식 TTS 테스트 (마크다운, URL, 리스트)
- 한국어 발음 검증 (시간, 전화번호, 호텔명)
- 모바일/데스크톱 브라우저 호환성

---

## 5. 예상 작업량

- ttsEngine.js: ~80줄
- textPreprocessor.js: ~100줄
- index.html 수정: ~30줄
- style.css 추가: ~40줄
- **총: ~250줄**

---

## 6. 리스크 및 대응

| 리스크 | 대응 |
|--------|------|
| 브라우저 미지원 | `window.speechSynthesis` 체크, 미지원 시 버튼 숨김 |
| 한국어 음성 없음 | 음성 목록에서 `ko` 포함 음성 탐색, 없으면 기능 비활성화 |
| 긴 답변 끊김 | 문장 단위 분할 발화 (utterance queue) |
| Safari 버그 | `speechSynthesis.cancel()` 호출 후 재생 패턴 적용 |

---

## 7. 향후 확장 (V2)

- Edge TTS 백엔드 연동 (고품질 Neural 음성)
- 음성 속도/피치 조절 UI
- 읽는 중 텍스트 하이라이팅
- 다국어 TTS (영어/일본어)
