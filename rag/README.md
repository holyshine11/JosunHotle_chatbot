# LangGraph RAG μ„λ²„

LangGraph κΈ°λ° μ΅°μ„ νΈν…” FAQ μ±—λ΄‡ RAG μ‹μ¤ν…μ…λ‹λ‹¤.

## μ•„ν‚¤ν…μ²

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  preprocess β”‚  μ…λ ¥ μ •κ·ν™”, μ–Έμ–΄/νΈν…”/μΉ΄ν…κ³ λ¦¬ κ°μ§€
β””β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”
       β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚  retrieve   β”‚  Vector DB κ²€μƒ‰ (Top-5)
β””β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”
       β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚evidence_gateβ”‚  κ·Όκ±° κ²€μ¦ (μ μ >= 0.5)
β””β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”
       β”‚
   β”β”€β”€β”€β”΄β”€β”€β”€β”
   β”‚ pass? β”‚
   β””β”€β”€β”€β”¬β”€β”€β”€β”
  Yes  β”‚  No
   β–Ό   β”‚   β–Ό
β”β”€β”€β”€β”€β”€β”€β”΄β”€β”€β”  β”β”€β”€β”€β”€β”€β”
β”‚ answer  β”‚  β”‚ log β”‚ β†’ κΈ°λ³Έ λ‹µλ³€ (κ³ κ°μ„Όν„° μ•λ‚΄)
β”‚ compose β”‚  β””β”€β”€β”€β”€β”€β”
β””β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”
     β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚policy_filterβ”‚  κΈμ§€ μ£Όμ /κ°μΈμ •λ³΄ ν•„ν„°
β””β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”
       β–Ό
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚    log      β”‚  λ€ν™” κΈ°λ΅ μ €μ¥
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

## μ‚¬μ©λ²•

### CLI ν…μ¤νΈ

```bash
PYTHON=~/.pyenv/versions/3.11.7/bin/python3

# RAG κ·Έλν”„ ν…μ¤νΈ
$PYTHON rag/graph.py
```

### API μ„λ²„ μ‹¤ν–‰

```bash
# μ„λ²„ μ‹μ‘ (http://localhost:8000)
$PYTHON rag/server.py

# λλ” uvicorn μ§μ ‘ μ‹¤ν–‰
$PYTHON -m uvicorn rag.server:app --reload --host 0.0.0.0 --port 8000
```

### API μ—”λ“ν¬μΈνΈ

| λ©”μ„λ“ | κ²½λ΅ | μ„¤λ… |
|-------|------|-----|
| GET | / | ν—¬μ¤ μ²΄ν¬ |
| GET | /health | ν—¬μ¤ μ²΄ν¬ |
| POST | /chat | μ±„ν… API |
| GET | /hotels | νΈν…” λ©λ΅ |
| GET | /docs | Swagger UI |

### API μ‚¬μ© μμ‹

```bash
# μ±„ν… μ”μ²­
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"query": "μ²΄ν¬μΈ μ‹κ°„μ΄ μ–΄λ–»κ² λλ‚μ”?"}'

# νΈν…” μ§€μ • μ±„ν…
curl -X POST http://localhost:8000/chat \
  -H "Content-Type: application/json" \
  -d '{"query": "μ£Όμ°¨ μ”κΈ", "hotel": "josun_palace"}'

# νΈν…” λ©λ΅
curl http://localhost:8000/hotels
```

### Pythonμ—μ„ μ§μ ‘ μ‚¬μ©

```python
from rag.graph import createRAGGraph

# RAG κ·Έλν”„ μƒμ„±
rag = createRAGGraph()

# μ±„ν…
result = rag.chat("μ²΄ν¬μΈ μ‹κ°„μ΄ μ–΄λ–»κ² λλ‚μ”?")
print(result["answer"])

# νΈν…” μ§€μ • μ±„ν…
result = rag.chat("μ£Όμ°¨ μ”κΈ μ•λ ¤μ£Όμ„Έμ”", hotel="josun_palace")
print(result["answer"])
```

## μ‘λ‹µ κµ¬μ΅°

```json
{
  "answer": "[μ΅°μ„  ν°λ¦¬μ¤] μ²΄ν¬μΈ μ‹κ°„μ€ μ¤ν›„ 3μ‹, μ²΄ν¬μ•„μ›ƒ μ‹κ°„μ€ μ¤ν›„ 12μ‹μ…λ‹λ‹¤.\n\nπ“ μ¶μ²: https://jpg.josunhotel.com/about/faq.do",
  "hotel": "josun_palace",
  "category": "μ²΄ν¬μΈ/μ•„μ›ƒ",
  "evidence_passed": true,
  "sources": ["https://jpg.josunhotel.com/about/faq.do"],
  "score": 0.815
}
```

## ν•µμ‹¬ μ •μ±…

### No Retrieval, No Answer

- κ²€μƒ‰ κ²°κ³Ό μ μκ°€ 0.5 λ―Έλ§μ΄λ©΄ λ‹µλ³€ μƒμ„± κΈμ§€
- κΈ°λ³Έ λ‹µλ³€: "μ£„μ†΅ν•©λ‹λ‹¤, ν„μ¬ λ°μ΄ν„°λ΅λ” ν•΄λ‹Ή μ •λ³΄λ¥Ό ν™•μΈν•κΈ° μ–΄λ µμµλ‹λ‹¤. νΈν…”μ— μ§μ ‘ λ¬Έμν•΄ μ£Όμ„Έμ”."

### κ°μΈμ •λ³΄ λ³΄νΈ

- μμ•½λ²νΈ, μΉ΄λ“λ²νΈ λ“± κ°μΈμ •λ³΄ κ΄€λ ¨ μ§λ¬Έμ€ μ°¨λ‹¨
- μ‘λ‹µ: "κ°μΈμ •λ³΄λ” μ±—λ΄‡μ—μ„ μ²λ¦¬ν•  μ μ—†μµλ‹λ‹¤. νΈν…” κ³ κ°μ„Όν„°λ΅ λ¬Έμν•΄ μ£Όμ„Έμ”."

### μ¶μ² ν‘μ‹

- λ¨λ“  λ‹µλ³€μ— μ¶μ² URL ν¬ν•¨
- FAQ λ‹µλ³€μ κ²½μ° νΈν…”λ… prefix μ¶”κ°€

## νΈν…” μλ™ κ°μ§€

μ§λ¬Έμ—μ„ νΈν…” ν‚¤μ›λ“λ¥Ό κ°μ§€ν•μ—¬ μλ™ ν•„ν„°λ§:

| νΈν…” | κ°μ§€ ν‚¤μ›λ“ |
|-----|-----------|
| μ΅°μ„  ν°λ¦¬μ¤ | ν°λ¦¬μ¤, palace, κ°•λ‚¨ |
| κ·Έλλ“ μ΅°μ„  λ¶€μ‚° | λ¶€μ‚°, ν•΄μ΄λ€, busan |
| κ·Έλλ“ μ΅°μ„  μ μ£Ό | μ μ£Ό, jeju |
| λ μ¤μΌ€μ΄ν”„ | λ μ¤μΌ€μ΄ν”„, λ…λ™ |
| κ·ΈλλΉ„ν‹° νκµ | κ·ΈλλΉ„ν‹°, νκµ, gravity |

## λ΅κ·Έ

λ€ν™” λ΅κ·Έλ” `data/logs/chat_YYYYMMDD.jsonl`μ— μ €μ¥λ©λ‹λ‹¤.

```json
{
  "timestamp": "2026-02-04T10:30:00",
  "query": "μ²΄ν¬μΈ μ‹κ°„",
  "hotel": "josun_palace",
  "category": "μ²΄ν¬μΈ/μ•„μ›ƒ",
  "evidence_passed": true,
  "top_score": 0.815,
  "chunks_count": 5,
  "final_answer": "..."
}
```
